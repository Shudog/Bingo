
<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>Barebones Heroes Bingo!</title>
</head>
<body style="background-color: #2c2f33">
    <div class="container">
        <div class="row" style="padding-top: 10px">
            <div class="col">
                <h2 style="color: #fff">Welcome to gillyShark Heroes Bingo! Please select your bingo board options below!</h2>
            </div>
        </div>
        <div class="row" style="padding-top: 10px">
            <div class="col">
                <div class="form-check form-check-inline" style="padding-left: 0px;">
                    <input class="btn-check" type="checkbox" value="" id="btnSingleplayer" checked>
                    <label class="btn btn-outline-light" for="btnSingleplayer">
                        Singleplayer
                    </label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="btn-check" type="checkbox" value="" id="btnMultiplayer" checked>
                    <label class="btn btn-outline-light" for="btnMultiplayer">
                        Multiplayer
                    </label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="btn-check" type="checkbox" value="" id="btnCustom" checked>
                    <label class="btn btn-outline-light" for="btnCustom">
                        Custom
                    </label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="btn-check" type="checkbox" value="" id="btnCCL" onclick="toggleCCLOptions()">
                    <label class="btn btn-outline-light" for="btnCCL" onclick="toggleCCLOptions()">
                        CCL Viewer
                    </label>
                </div>
            </div>
        </div>
        <div class="row" style="padding-top: 10px; padding-left: 0px">
            <div class="col">
                <div class="form-check form-check-inline" style="padding-left: 0px;">
                    <button id="heroesBingoBtn" class="btn btn-success" onclick="heroesBingoEntry()">Generate New Bingo Board</button>
                </div>
            </div>

        </div>
    </div>
    </div>
    
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>

<script>
    var isFirstBoard = true;
    var bingoCardsJson;
    var buttonSelection = "";
    var selectedOptions = new Array();
    window.onload = function () {
        //prepareData();
    }

    function toggleCCLOptions() {
        if (document.getElementById("btnCCL").checked) {
            document.getElementById("btnSingleplayer").checked = false;
            document.getElementById("btnSingleplayer").disabled = true;

            document.getElementById("btnMultiplayer").checked = false;
            document.getElementById("btnMultiplayer").disabled = true;

            document.getElementById("btnCustom").checked = false;
            document.getElementById("btnCustom").disabled = true;
        } else {
            document.getElementById("btnSingleplayer").disabled = false;
            document.getElementById("btnMultiplayer").disabled = false;
            document.getElementById("btnCustom").disabled = false;
        }
    }

    function heroesBingoEntry() {
        cleanBoard();
        buttonSelection = "heroesBingo";
        addSelections();
        prepareData();
    }

    function addSelections() {
        if (document.getElementById("btnSingleplayer").checked) {
            selectedOptions.push("IsSingleplayer");
        }

        if (document.getElementById("btnMultiplayer").checked) {
            selectedOptions.push("IsMultiplayer");
        }

        if (document.getElementById("btnCustom").checked) {
            selectedOptions.push("IsCustom");
        }

        if (document.getElementById("btnCCL").checked) {
            selectedOptions.push("IsCCL");
        }
    }

    function prepareData() {
        retrieveJSON();

        if (isFirstBoard) {
            $(document).on('click', '#bingoBoardTD', function () {
                var color = $(this).css('background-color');
                if (color == "rgb(33, 37, 41)") {
                    $(this).css("background-color", "red");
                    $(this).css("background-image", 'url("new_gillyShark_112.png")');
                    $(this).css("background-repeat", 'no-repeat');
                    $(this).css("background-position", "center");
                }
                else {
                    $(this).css("background-color", "rgb(33, 37, 41)");
                    $(this).css("background-image", '');
                }
            });
            isFirstBoard = false;
        }
        
        //Do any extra setup stuff.
    }

    function cleanBoard() {
        if (document.getElementById("bingoDiv") != null) {
            var message = document.getElementById("bingoDiv");
            message.remove();
        }

        //if (document.getElementById("tblDivRow") != null) {
        //    var bingoBoard = document.getElementById("bingoBoard");
        //    bingoBoard.remove();
        //}

        bingoCardsJson = "";
        buttonSelection = "";
        selectedOptions = new Array();
    }

    async function retrieveJSON() {
        var fetchFile = "";
        switch (buttonSelection) {
            case "":
                fetchFile = "HeroesBingoData.json";
                break;
            case "heroesBingo":
                fetchFile = "HeroesBingoData.json";
                break;

        }
        bingoCardsJson = await fetch(fetchFile)
            .then(response => {
                return response.json();
            });

        printTable();
    }

    function printTable() {
        //body reference
        var body = document.getElementsByTagName("body")[0];

        //set up bootstrap container divs
        var containerDiv = document.createElement("div");
        containerDiv.setAttribute('class', 'container-fluid');
        containerDiv.setAttribute('id', 'bingoDiv');

        //instructions
        var instructDivRow = document.createElement("div");
        var instructDivCol = document.createElement("div");
        var instructMsg = document.createElement("h3");
        instructDivRow.setAttribute('id', 'heroesBingoMessage');
        instructDivRow.setAttribute('class', 'row justify-content-center');
        instructDivCol.setAttribute('class', 'col align-self-center');
        instructMsg.setAttribute('style', "color: #fff");
        instructMsg.innerHTML = "Mouse over each challenge for more information.";
        instructDivCol.appendChild(instructMsg);
        instructDivRow.appendChild(instructDivCol);
        containerDiv.appendChild(instructDivRow);

        // create elements <table> and a <tbody>
        var tblDivRow = document.createElement("div");
        var tblDivCol = document.createElement("div");
        tblDivRow.setAttribute('class', 'row justify-content-center');
        tblDivRow.setAttribute('id', 'tblDivRow');
        tblDivCol.setAttribute('class', 'col align-self-center');
        var tbl = document.createElement("table");
        tbl.setAttribute('class', 'table table-dark table-bordered mx-auto');
        tbl.setAttribute('id', 'bingoBoard');
        var tblBody = document.createElement("tbody");

        //Table headers - not currently needed.
        //var row = document.createElement("tr");
        //var cellText;
        //var cell;

        //cellText = document.createTextNode("Challenge");
        //cell = document.createElement("th");
        //cell.appendChild(cellText);
        //row.appendChild(cell);
        //tblBody.appendChild(row);

        var usedBingoOptions = [];
        for (var i = 0; i < 5; i++) {
            row = document.createElement("tr");
            for (var j = 0; j < 5; j++) {

                //Pull until we get a bingo card we haven't used yet. Make this its own separate function if it gets any more complex.
                var bingoElement;
                var pullAgain = true;
                while (pullAgain) {
                    pullAgain = false;
                    var validOption = false;
                    bingoElement = bingoCardsJson[getRandomInt(bingoCardsJson.length)];
                    selectedOptions.forEach(function (element, index, array) {
                        if (bingoElement[element] == "Yes") {
                            validOption = true;
                        } else {
                            pullAgain = true;
                        }
                    });
                    if (validOption) {
                        usedBingoOptions.forEach(function (element, index, array) {
                            if (bingoElement.Nickname == element.Nickname) {
                                pullAgain = true;
                            }
                        });
                    }
                }
                usedBingoOptions.push(bingoElement);

                //Create the cell
                cellText = document.createTextNode(bingoElement.Nickname);
                cell = document.createElement("td");
                cell.appendChild(cellText);
                cell.setAttribute('title', bingoElement.Challenge);
                cell.setAttribute('class', 'td');
                cell.setAttribute('id', 'bingoBoardTD');
                cell.setAttribute('height', '135px');
                cell.setAttribute('width', '150px');
                row.appendChild(cell);
            }
            tblBody.appendChild(row);
        }
        // append the <tbody> inside the <table>
        tbl.appendChild(tblBody);
        // put <table> in the <body>
        tblDivCol.appendChild(tbl);
        tblDivRow.appendChild(tblDivCol);
        containerDiv.appendChild(tblDivRow);
        body.appendChild(containerDiv);
    }

    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }

</script>
